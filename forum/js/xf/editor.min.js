var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(e,k,l){e instanceof String&&(e=String(e));for(var m=e.length,a=0;a<m;a++){var b=e[a];if(k.call(l,b,a,e))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(e,k,l){e!=Array.prototype&&e!=Object.prototype&&(e[k]=l.value)};
$jscomp.getGlobal=function(e){return"undefined"!=typeof window&&window===e?e:"undefined"!=typeof global&&null!=global?global:e};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(e,k,l,m){if(k){l=$jscomp.global;e=e.split(".");for(m=0;m<e.length-1;m++){var a=e[m];a in l||(l[a]={});l=l[a]}e=e[e.length-1];m=l[e];k=k(m);k!=m&&null!=k&&$jscomp.defineProperty(l,e,{configurable:!0,writable:!0,value:k})}};
$jscomp.polyfill("Array.prototype.find",function(e){return e?e:function(e,l){return $jscomp.findInternal(this,e,l).v}},"es6","es3");
!function(e,k,l,m){XF.isEditorEnabled=function(){return XF.LocalStorage.get("editorDisabled")?!1:!0};XF.setIsEditorEnabled=function(a){a?XF.LocalStorage.remove("editorDisabled"):XF.LocalStorage.set("editorDisabled","1",!0)};XF.Editor=XF.Element.newHandler({options:{maxHeight:.7,minHeight:250,buttonsRemove:"",attachmentTarget:!0,deferred:!1,attachmentUploader:".js-attachmentUpload",attachmentContextInput:"attachment_hash_combined"},edMinHeight:63,$form:null,buttonManager:null,ed:null,mentioner:null,
emojiCompleter:null,uploadUrl:null,init:function(){this.$target.is("textarea")?(this.options.minHeight=Math.max(this.edMinHeight,this.options.minHeight),this.$target.trigger("editor:start",[this]),this.$form=this.$target.closest("form"),this.$form.length||(this.$form=null),this.options.attachmentTarget&&(this.uploadUrl=this.$target.closest("[data-xf-init~=attachment-manager]").find(this.options.attachmentUploader).attr("href")),this.options.deferred||this.startInit()):console.error("Editor can only be initialized on a textarea")},
startInit:function(a){var b=this,d=a&&a.beforeInit,c=a&&a.afterInit;this.$target.css("visibility","").on("froalaEditor.initialized",function(a,e){b.ed=e;d&&d(b,e);b.editorInit();c&&c(b,e)}).froalaEditor(this.getEditorConfig())},getEditorConfig:function(){var a=this.getHeightLimits();a={direction:e.FE.LANGUAGE.xf.direction,editorClass:"bbWrapper",fileUpload:!1,fileMaxSize:4294967296,fileUploadParam:"upload",fileUploadURL:!1,fontFamily:{arial:"Arial","'book antiqua'":"Book Antiqua","'courier new'":"Courier New",
georgia:"Georgia",tahoma:"Tahoma","'times new roman'":"Times New Roman","'trebuchet ms'":"Trebuchet MS",verdana:"Verdana"},fontSize:"9 10 12 15 18 22 26".split(" "),heightMin:a[0],heightMax:a[1],htmlAllowedTags:"a b bdi bdo blockquote br cite code dfn div em h1 h2 h3 h4 h5 h6 hr i img li mark ol p pre s script style small span strike strong sub sup table tbody td tfoot th thead time tr u ul var video wbr".split(" "),key:"5D5C4B4B3aG3C2A5A4C4E3E2D4F2G2tFOFSAGLUi1AVKd1SN==",htmlAllowComments:!1,imageUpload:!1,
imageCORSProxy:null,imageDefaultDisplay:"inline",imageDefaultWidth:"auto",imageEditButtons:"imageAlign imageSize imageAlt | imageReplace imageRemove | imageLink linkOpen linkEdit linkRemove".split(" "),imageManagerLoadURL:!1,imageMaxSize:4294967296,imagePaste:!1,imageResize:!0,imageUploadParam:"upload",imageUploadRemoteUrls:!1,imageUploadURL:!1,language:"xf",linkAlwaysBlank:!0,linkEditButtons:["linkOpen","linkEdit","linkRemove"],linkInsertButtons:["linkBack"],placeholderText:"",tableResizer:!1,tableEditButtons:["tableHeader",
"tableRemove","|","tableRows","tableColumns"],toolbarSticky:!1,videoAllowedTypes:["mp4","quicktime","ogg","webm"],videoAllowedProviders:[],videoDefaultAlign:"left",videoDefaultDisplay:"inline",videoDefaultWidth:500,videoEditButtons:["videoReplace","videoRemove","|","videoAlign","videoSize"],videoInsertButtons:["videoBack","|","videoUpload"],videoMaxSize:4294967296,videoMove:!0,videoUpload:!1,videoUploadParam:"upload",videoUploadURL:!1,zIndex:XF.getElEffectiveZIndex(this.$target)+1,xfBbCodeAttachmentContextInput:this.options.attachmentContextInput};
e.FE.DT=!0;e.FE.DefineIconTemplate("xf_font_awesome_5",'<i class="fa'+XF.config.fontAwesomeWeight+' fa-[NAME]" aria-hidden="true"></i>');e.FE.ICON_DEFAULT_TEMPLATE="xf_font_awesome_5";e.FE.DefineIcon("insertVideo",{NAME:"video-plus"});e.FE.DefineIcon("undo",{NAME:"undo"});e.FE.DefineIcon("redo",{NAME:"redo"});e.FE.DefineIcon("tableHeader",{NAME:"heading"});if(this.uploadUrl){var b={_xfToken:XF.config.csrf,_xfResponseType:"json",_xfWithData:1};a.fileUpload=!0;a.fileUploadParams=b;a.fileUploadURL=this.uploadUrl;
a.imageUpload=!0;a.imageUploadParams=b;a.imageUploadURL=this.uploadUrl;a.imagePaste=!0;a.videoUpload=!0;a.videoUploadParams=b;a.videoUploadURL=this.uploadUrl}else a.imageInsertButtons=["imageByURL"];b=this.getButtonConfig();a=e.extend({},a,b);this.$target.trigger("editor:config",[a,this]);return a},getButtonConfig:function(){try{var a=e.parseJSON(e(".js-editorToolbars").first().html())||{}}catch(g){console.error("Editor buttons data not valid: ",g);return}var b={};try{var d=e.parseJSON(e(".js-editorDropdowns").first().html())||
{},c;for(c in d)d.hasOwnProperty(c)&&d[c].buttons&&(b[c]=d[c].buttons)}catch(g){console.error("Editor dropdowns data not valid: ",g)}this.buttonManager=a=new XF.EditorButtons(this,a,b);this.$form&&this.$form.is("[data-xf-init~=draft]")||a.addRemovedButton("xfDraft");(b=this.getAttachmentManager())&&b.supportsVideoUploads||a.addRemovedButton("insertVideo");this.options.buttonsRemove&&a.addRemovedButtons(this.options.buttonsRemove.split(","));this.$target.trigger("editor:toolbar-buttons",[{buttonManager:a},
this]);return a.getToolbars()},editorInit:function(){var a=this,b=this.ed;this.watchEditorHeight();this.$form&&(this.$form.on("ajax-submit:before draft:beforesync",function(){b.$oel.val(a.ed.html.get())}),this.$form.on("draft:complete",function(){var a=b.$tb.find(".fr-command.fr-btn[data-cmd=xfDraft]"),c=a.find(".editorDraftIndicator");c.length||(c=e('<b class="editorDraftIndicator" />').appendTo(a));setTimeout(function(){c.addClass("is-active")},50);setTimeout(function(){c.removeClass("is-active")},
2500)}),this.$form.on("ajax-submit:before",function(a,c){0<b.$el.find(".fr-uploading").length&&!confirm(XF.phrase("files_being_uploaded_are_you_sure"))&&(c.preventSubmit=!0)}),b.events.on("keydown",function(b){if("Enter"==b.key&&(XF.isMac()?b.metaKey:b.ctrlKey))return b.preventDefault(),a.$form.submit(),!1},!0));b.$tb.find("[data-cmd=align][data-param1=justify]").closest("li").css("display","none");b.events.on("image.inserted",function(a){a.removeClass("fr-dib").addClass("fr-dii")});b.events.on("image.loaded",
function(b){a.replaceBase64ImageWithUpload(b)});b.events.on("image.beforePasteUpload",function(a){if("data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="==a.src)return!1});var d=!1;b.events.on("cut copy",function(a){if((a=b.selection.ranges(0))&&a.commonAncestorContainer){a=a.commonAncestorContainer;a.nodeType==Node.TEXT_NODE&&(a=a.parentNode);var c=e(a).find("p");e(a).find("p").attr("data-xf-p","1");setTimeout(function(){c.removeAttr("data-xf-p")},0)}});b.events.on("paste.before",
function(a){d=!1;if(a&&a.clipboardData&&a.clipboardData.getData){var c="";a=a.clipboardData.types;if(b.helpers.isArray(a))for(var e=0;e<a.length;e++)c+=a[e]+";";else c=a;!/text\/plain/.test(c)||b.browser.mozilla||/text\/html/.test(c)||/text\/rtf/.test(c)&&b.browser.safari||(d=!0)}});b.events.on("paste.beforeCleanup",function(a){d&&(a=a.replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,">&nbsp;"));a=a.replace(/(<pre[^>]*>)([\s\S]+)(<\/pre>)/g,function(a,b,c,e){c=
c.replace(/\r?\n/g,"<br>");return b+c+e});a=a.replace(/<div(?=\s|>)/g,function(a){return a+' data-xf-p="1"'});var b;(b=a.match(/^(?:<meta charset=(?:'|")[^'"]*(?:'|")>)?<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>$/))&&(a=e.trim(b[1]));(b=a.match(/\x3c!--StartFragment--\x3e<a href=(?:'|")([^'"]*)\/?(?:'|")>\1<\/a>\x3c!--EndFragment--\x3e/))&&(a=e.trim(b[1]));return XF.adjustHtmlForRte(a)});b.events.on("paste.afterCleanup",function(b){return a.normalizePaste(b)});b.events.on("paste.after",function(){var c=
b.selection.ranges(0);if(c&&c.getBoundingClientRect){c=c.getBoundingClientRect();var d=b.$wp[0].getBoundingClientRect();(0>c.top||0>c.left||c.bottom>e(k).height()||c.right>e(k).width()||c.bottom>d.bottom)&&setTimeout(function(){a.scrollToCursor()},100)}});b.events.on("popups.show.colors.picker",function(){e(this.popups.get("colors.picker")).find(".fr-colors-buttons").css("display","none")});var c={url:XF.getAutoCompleteUrl()};this.mentioner=new XF.AutoCompleter(b.$el,c,b);XF.config.shortcodeToEmoji&&
(c={url:XF.canonicalizeUrl("index.php?misc/find-emoji"),at:":",keepAt:!1,insertMode:"html",displayTemplate:'<div class="contentRow"><div class="contentRow-figure contentRow-figure--emoji">{{{icon}}}</div><div class="contentRow-main contentRow-main--close">{{{text}}}<div class="contentRow-minor contentRow-minor--smaller">{{{desc}}}</div></div></div>',beforeInsert:function(a,b){XF.logRecentEmojiUsage(e(b).find("img.smilie").data("shortname"));return a}},this.emojiCompleter=new XF.AutoCompleter(b.$el,
c,b));this.setupUploads();XF.isEditorEnabled()||(c=this.$target.next("input[data-bb-code]"),c.length?b.bbCode.toBbCode(c.val(),!0):b.bbCode.toBbCode(null,!0));XF.EditorHelpers.setupBlurSelectionWatcher(b);this.$target.on("control:enabled",function(){b.edit.on()});this.$target.on("control:disabled",function(){b.edit.off()});this.$target.on("control:enabled",function(){b.edit.on();b.bbCode&&b.bbCode.isBbCodeView()?b.$tb.find(".fr-command[data-cmd=xfBbCode]").removeClass("fr-disabled"):b.toolbar.enable()});
this.$target.on("control:disabled",function(){b.edit.off();b.toolbar.disable();b.$tb.find(" > .fr-command").addClass("fr-disabled")});this.$target.trigger("editor:init",[b,this]);XF.layoutChange()},focus:function(){XF.EditorHelpers.focus(this.ed)},blur:function(){XF.EditorHelpers.blur(this.ed)},normalizePaste:function(a){a=a.replace(/(<(ul|li|p|div)>)\s+/ig,"$1");a=a.replace(/\s+(<\/(ul|li|p|div)>)/ig,"$1");a=a.replace(/<span>&nbsp;<\/span>/ig," ").replace(/(<\/li>)\s+(<li)/ig,"$1$2");var b=this.ed,
d=e.parseHTML(a),c=e("<div />").html(d);c.find("table").each(function(a,b){a=e(b).width("100%");a.wrap('<div class="bbTable"></div>');a.find("[colspan], [rowspan]").removeAttr("colspan rowspan");var c=0;a.find("> tbody > tr").each(function(){var a=e(this).find("> td, > th").length;c=Math.max(c,a)}).each(function(){var a=e(this).find("> td, > th"),b=a.length;if(b<c){var d="<td />";for(b&&"TH"===a[0].tagName&&(d="<th />");b<c;b++)e(this).append(d)}})});c.find("code, del, ins, sub, sup").replaceWith(function(){return this.innerHTML});
c.find("h1, h2, h3, h4, h5, h6").replaceWith(function(){var a="<b>"+this.innerHTML+"</b>",c=b.opts.fontSize;switch(this.tagName){case "H1":a='<span style="font-size: '+c[6]+'px">'+a+"</span>";break;case "H2":a='<span style="font-size: '+c[5]+'px">'+a+"</span>";break;case "H3":a='<span style="font-size: '+c[4]+'px">'+a+"</span>"}return a+"<br>"});c.find("pre").replaceWith(function(){var a=this.innerHTML;a=a.replace(/\r?\n/g,"<br>").replace(/\t/g,"    ").replace(/  /g,"&nbsp; ").replace(/  /g,"&nbsp; ").replace(/> /g,
">&nbsp;").replace(/<br> /g,"<br>&nbsp;");return a+"<br>"});c.find("br").each(function(a,d){var g=e(d).parents().not(c);if(g.length&&!g.filter(function(a,c){return b.node.isBlock(c)}).length){a=e([]);var h=!1,f=d,n=g.last();do{for(;f.nextSibling;)g=e(f.nextSibling).clone(),h?a.append(g):a=a.add(g),e(f.nextSibling).remove();f=f.parentNode;if(!f||c.is(f))break;g=e(f).clone().empty();g.html(a);a=g;h=!0}while(f.parentNode&&!c.is(f.parentNode));e(d).remove();n.after(a);n.after("<br />")}});a="";d=c[0].textContent.replace(/\s/g,
"");try{a=(b.win.localStorage.getItem("fr-copied-text")||"").replace(/\s/g,"")}catch(n){}a.length&&a!=d&&c.find("> p:not([data-xf-p])").each(function(){this.nextSibling&&e(this).after("<p />")});c.find("p").removeAttr("data-xf-p");d=c.contents();a=e("<div />");for(var g=null,h=0;h<d.length;h++){var f=d[h];f.nodeType==Node.ELEMENT_NODE&&b.node.isBlock(f)?(a.append(f),g=null):f.nodeType==Node.ELEMENT_NODE&&"BR"==f.tagName?(g||a.append("<p />"),g=null):(g||(g=e("<p />"),a.append(g)),g.append(f))}d=a.children();
1==d.length&&d.is("p, div")&&(a=d);return a.html()},watchEditorHeight:function(){var a=this.ed,b=this;e(k).onPassive("resize",function(){var c=b.getHeightLimits();a.opts.heightMin=c[0];a.opts.heightMax=c[1];a.size.refresh();XF.layoutChange()});a.events.on("focus",function(){b.scrollToCursorAfterPendingResize()});var d=a.$wp.height(),c=function(){var b=a.$wp.height();d!=b&&(d=b,XF.layoutChange())};a.events.on("keyup",c);a.events.on("commands.after",c);a.events.on("html.set",c);a.events.on("init",c);
a.events.on("initialized",c)},getHeightLimits:function(){var a=this.options.maxHeight,b=this.options.minHeight,d=null,c=null;this.$target.closest(".overlay").length&&(a=.1);a&&(d=e(k).height(),/(iPad|iPhone|iPod)/g.test(navigator.userAgent)&&(d-=250),d=Math.floor(0<a?1>=a?d*a:a:d+a),d=Math.max(d,150));b&&d&&(c=Math.min(b,d),c==d&&--c);return[c,d]},setupUploads:function(){var a=this,b=this.ed;b.events.on("file.uploaded",function(b){this.popups.hide("file.insert");this.events.focus();return a.handleUploadSuccess(b)});
b.events.on("file.error",function(b,d){this.popups.hide("file.insert");a.handleUploadError(b,d);this.events.focus();return!1});this.uploadUrl||(b.events.on("image.beforeUpload",function(){return!1}),b.events.on("file.beforeUpload",function(){return!1}),b.events.on("video.beforeUpload",function(){return!1}));b.events.on("image.error",function(b,d){if(d)return this.popups.hide("image.insert"),a.handleUploadError(b,d),!1});b.events.on("video.error",function(b,d){if(d)return this.popups.hide("video.insert"),
a.handleUploadError(b,d),!1});b.events.on("image.uploaded",function(c){return a.handleUploadSuccess(c,function(){b.image.remove();b.popups.hide("image.insert");b.events.focus();return!1},function(){return!0})});b.events.on("video.uploaded",function(c){return a.handleUploadSuccess(c,function(){b.video.remove();b.popups.hide("video.insert");b.events.focus();return!1},function(){return!0})});var d=function(a,b){if(b){try{var c=e.parseJSON(b)}catch(r){return}a.hasClass("fr-video")&&(a=a.find("video"),
a.attr("data-xf-init","video-init").attr("style","").empty());if(c.attachment){c=c.attachment.attachment_id;b=a[0].attributes;for(var d=/^data-(?!xf-init)/,g=b.length-1;0<=g;g--)d.test(b[g].nodeName)&&a.removeAttr(b[g].nodeName);a.attr("data-attachment","full:"+c)}}};b.events.on("image.inserted video.inserted",d);b.events.on("image.replaced video.replaced",d);b.events.on("image.loaded",function(c){if(b.popups.isVisible("image.edit")){var d=b.image.get();d&&d[0]==c[0]&&(b.image.exitEdit(!0),d=b.selection.ranges(0),
d.setStartAfter(c[0]),d.collapse(!0),c=b.selection.get(),c.removeAllRanges(),c.addRange(d),b.events.focus(),a.scrollToCursor())}});b.events.on("video.loaded",function(c){if(b.popups.isVisible("video.edit")){var d=b.video.get();d&&d[0]==c[0]&&(b.events.trigger("video.hideResizer"),b.popups.hide("video.edit"),d=b.selection.ranges(0),d.setStartAfter(c[0]),d.collapse(!0),c=b.selection.get(),c.removeAllRanges(),c.addRange(d),b.events.focus(),a.scrollToCursor())}});b.events.on("popups.show.image.edit",
function(){var a=b.image.get();a.length&&a.hasClass("smilie")&&(b.image.exitEdit(!0),b.selection.save(),setTimeout(function(){b.selection.restore()},0))})},handleUploadSuccess:function(a,b,d){try{var c=e.parseJSON(a)}catch(g){c={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]}}return c.status&&"error"==c.status?(XF.alert(c.errors[0]),b?b(c):!1):(a=this.getAttachmentManager())&&c.attachment?(a.insertUploadedRow(c.attachment),d?d(c,a):!1):!1},handleUploadError:function(a,b){try{var d=
e.parseJSON(b)}catch(c){d=null}d&&d.errors||(d={status:"error",errors:[XF.phrase("oops_we_ran_into_some_problems")]});XF.alert(d.errors[0])},getAttachmentManager:function(){var a=this.$target.closest("[data-xf-init~=attachment-manager]");return a&&a.length?XF.Element.getHandler(a,"attachment-manager"):null},isBbCodeView:function(){return this.ed.bbCode&&this.ed.bbCode.isBbCodeView?this.ed.bbCode.isBbCodeView():!1},insertContent:function(a,b){var d=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&
d.bbCode.insertBbCode(b):(this.focus(),d.html.insert(a),XF.Element.initialize(d.$el));this.scrollToCursor();this.scrollToCursorAfterPendingResize()},replaceContent:function(a,b){var d=this.ed;this.isBbCodeView()?"undefined"!==typeof b&&d.bbCode.replaceBbCode(b):d.html.set(a)},scrollToCursor:function(){var a=this.ed;if(this.isBbCodeView())a.bbCode.getTextArea().autofocus(),a.$box[0].scrollIntoView(!0);else{this.focus();var b=a.$box,d=a.$wp,c=a.selection.endElement(),e=c.getBoundingClientRect().bottom,
h=!0,f=XF.windowHeight();XF.browser.ios&&(f-=250);if(0>e||e>=f)h=!1;if(d&&h){var n=d[0].getBoundingClientRect();if(e>n.bottom||e<n.top)h=!1}if(!h){e=b[0].getBoundingClientRect();if(0>e.top||e.bottom>=f)XF.browser.ios||b.addClass("is-scrolling-to"),b[0].scrollIntoView(!0),b.removeClass("is-scrolling-to");d?(b=a.position.getBoundingRect().top,b>d.offset().top-a.helpers.scrollTop()+d.height()-50&&d.scrollTop(b+d.scrollTop()-(d.height()+d.offset().top)+a.helpers.scrollTop()+f/2)):c.scrollIntoView()}}},
scrollToCursorAfterPendingResize:function(a){var b=this,d=this.ed,c,g=function(){e(k).off("resize",g);e(k).on("scroll",h);c&&clearTimeout(c);c=setTimeout(f,500)},h=function(){c&&clearTimeout(c);c=setTimeout(f,100)},f=function(){e(k).off("scroll",h);d.core.hasFocus()&&b.scrollToCursor()};e(k).on("resize",g);setTimeout(function(){e(k).off("resize",g)},2E3);a&&(c=setTimeout(f,1E3))},base64ToBytes:function(a,b){b=b||512;a=atob(a);for(var d=[],c=0;c<a.length;c+=b){for(var e=a.slice(c,c+b),h=Array(e.length),
f=0;f<e.length;f++)h[f]=e.charCodeAt(f);e=new Uint8Array(h);d.push(e)}return d},editorSupportsUploads:function(){return-1!==this.ed.opts.imageInsertButtons.indexOf("imageUpload")},imageMatchesBase64Encoding:function(a){return a.attr("src").match(/^data:(image\/([a-z0-9]+));base64,(.*)$/)},replaceBase64ImageWithUpload:function(a){if(!a.hasClass("smilie")){var b;if(b=this.imageMatchesBase64Encoding(a)){var d=b[1];var c=b[2];b=b[3];-1===this.ed.opts.imageAllowedTypes.indexOf(c)?a[0].remove():this.editorSupportsUploads()?
(a=new Blob(this.base64ToBytes(b),{type:d}),1024<a.size&&this.ed.image.upload([a])):a[0].remove()}}}});XF.EditorButtons=XF.create({xfEd:null,buttonClasses:null,toolbars:{},dropdowns:{},removeButtons:null,recalculateNeeded:!0,__construct:function(a,b,d){this.xfEd=a;this.removeButtons=[];b&&(this.toolbars=b);d&&(this.dropdowns=d)},addToolbar:function(a,b){this.toolbars[a]=b;this.recalculateNeeded=!0},adjustToolbar:function(a,b){var d=this.toolbars[a];return d?(this.toolbars[a]=b(d,a,this),this.recalculateNeeded=
!0):!1},adjustToolbars:function(a){for(var b in this.toolbars)this.toolbars.hasOwnProperty(b)&&this.adjustToolbar(b,a)},getToolbar:function(a){return this.getToolbars()[a]},getToolbars:function(){this.recalculateIfNeeded();return this.toolbars},addDropdown:function(a,b){this.dropdowns[a]=b;this.recalculateNeeded=!0},adjustDropdown:function(a,b){var d=this.dropdowns[a];return d?(this.dropdowns[a]=b(d,a,this),this.recalculateNeeded=!0):!1},adjustDropdowns:function(a){for(var b in this.dropdowns)this.dropdowns.hasOwnProperty(b)&&
this.adjustDropdown(b,a)},getDropdown:function(a){return this.getDropdowns()[a]},getDropdowns:function(){this.recalculateIfNeeded();return this.dropdowns},addRemovedButton:function(a){this.removeButtons.push(a);this.recalculateNeeded=!0},addRemovedButtons:function(a){for(var b=0;b<a.length;b++)this.removeButtons.push(a[b]);this.recalculateNeeded=!0},recalculateIfNeeded:function(){this.recalculateNeeded&&this.recalculate()},recalculate:function(){function a(a,b){"string"==typeof b&&e[b]&&(b=e[b]);
"string"==typeof b&&(b=b.split("|"));return a.filter(function(a){return!(0<=b.indexOf(a))})}function b(a){var b=[];for(f=0;f<a.length;f++){var c=a[f];var d="-vs"===c||"|"===c;var e="-hs"===c||"-"===c;if(d||e){c=d?"|":"-";if(e&&!b.length)continue;if(b.length){d=b[b.length-1];if(d===c)continue;e&&"|"===d&&b.pop()}}b.push(c)}return b}for(var d=this.removeButtons,c,e=this.getButtonClasses(),h,f=0;f<d.length;f++){c=d[f];for(h in this.toolbars)this.toolbars.hasOwnProperty(h)&&(this.toolbars[h]=a(this.toolbars[h],
c));for(h in this.dropdowns)this.dropdowns.hasOwnProperty(h)&&(this.dropdowns[h]=a(this.dropdowns[h],c))}for(h in this.dropdowns)if(this.dropdowns.hasOwnProperty(h)&&!this.dropdowns[h].length)for(var n in this.toolbars)this.toolbars.hasOwnProperty(n)&&(this.toolbars[n]=a(this.toolbars[n],h));for(h in this.toolbars)this.toolbars.hasOwnProperty(h)&&(this.toolbars[h]=b(this.toolbars[h],c));for(h in this.dropdowns)this.dropdowns.hasOwnProperty(h)&&(this.dropdowns[h]=b(this.dropdowns[h],c));this.recalculateNeeded=
!1},getButtonClasses:function(){this.buttonClasses||(this.buttonClasses={_basic:["bold","italic","underline","strikeThrough"],_extended:["color","fontFamily","fontSize","xfInlineCode"],_link:["insertLink"],_align:["align"],_list:["formatOL","formatUL","outdent","indent"],_indent:["outdent","indent"],_smilies:["xfSmilie"],_image:["insertImage"],_media:["insertVideo","xfMedia"],_block:["xfQuote","xfCode","xfSpoiler","xfInlineSpoiler","insertTable"]});return this.buttonClasses}});XF.EditorHelpers={setupBlurSelectionWatcher:function(a){var b=
a.$el,d=!1,c;e(l).on("mousedown keydown",function(b){d&&(a.$el[0]==b.target||e.contains(a.$el[0],b.target)||a.selection.inEditor()&&(c=a.selection.ranges(0)))});a.events.on("blur",function(){c?b.data("xf-ed-blur-sel",c):b.removeData("xf-ed-blur-sel");d=!1;c=null},!0);a.events.on("focus",function(){d=!0;c=null;setTimeout(function(){b.removeData("xf-ed-blur-sel")},0)});a.events.on("commands.before",function(b){(b=e.FE.COMMANDS[b])&&("undefined"==typeof b.focus||b.focus)&&XF.EditorHelpers.restoreMaintainedSelection(a)})},
restoreMaintainedSelection:function(a){var b=a.$el.data("xf-ed-blur-sel");a.selection.inEditor()||(b?(a.markers.remove(),a.markers.place(b,!0,0),a.markers.place(b,!1,0)):a.selection.setAtEnd(a.el),a.selection.restore())},focus:function(a){XF.EditorHelpers.restoreMaintainedSelection(a);a.events.focus()},blur:function(a){a.$el[0].blur();a.selection.clear()},wrapSelectionText:function(a,b,d,c){c&&a.selection.save();c=a.$el.find(".fr-marker");c.first().before(XF.htmlspecialchars(b));c.last().after(XF.htmlspecialchars(d));
a.selection.restore();a.placeholder.hide()},insertCode:function(a,b,d){switch(b.toLowerCase()){case "":var c="CODE";b="";break;default:c="CODE",b=b.toLowerCase()}d=d.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/\t/g,"    ").replace(/\n /g,"\n&nbsp;").replace(/  /g,"&nbsp; ").replace(/  /g," &nbsp;").replace(/\n/g,"</p><p>");d="["+c+(b?"="+b:"")+"]"+d+"[/"+c+"]";d.match(/<\/p>/i)&&(d=("<p>"+d+"</p>").replace(/<p><\/p>/g,"<p><br></p>"));a.html.insert(d)},
insertSpoiler:function(a,b){XF.EditorHelpers.wrapSelectionText(a,b?'[SPOILER="'+b+'"]':"[SPOILER]","[/SPOILER]",!0)},dialogs:{},loadDialog:function(a,b){var d=XF.EditorHelpers.dialogs;d[b]?d[b].show(a):console.error("Unknown dialog '"+b+"'")}};XF.EditorDialog=XF.create({ed:null,overlay:null,dialog:null,cache:!0,__construct:function(a){this.dialog=a},show:function(a){this.ed=a;a.selection.save();XF.loadOverlay(XF.canonicalizeUrl("index.php?editor/dialog&dialog="+this.dialog),{beforeShow:XF.proxy(this,
"beforeShow"),afterShow:XF.proxy(this,"afterShow"),init:XF.proxy(this,"init"),cache:this.cache})},init:function(a){var b=this;a.on("overlay:hidden",function(){b.ed&&b.ed.markers.remove()});this._init(a)},_init:function(a){},beforeShow:function(a){this.overlay=a;this._beforeShow(a)},_beforeShow:function(a){},afterShow:function(a){this._afterShow(a);a.$overlay.find("textarea, input").first().focus()},_afterShow:function(a){}});XF.EditorDialogMedia=XF.extend(XF.EditorDialog,{_beforeShow:function(a){e("#editor_media_url").val("")},
_init:function(a){e("#editor_media_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();var b=this.ed,d=this.overlay;XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/media"),{url:e("#editor_media_url").val()},function(a){a.matchBbCode?(b.selection.restore(),b.html.insert(XF.htmlspecialchars(a.matchBbCode)),d.hide()):a.noMatch?XF.alert(a.noMatch):(b.selection.restore(),d.hide())})}});XF.EditorDialogSpoiler=XF.extend(XF.EditorDialog,{_beforeShow:function(a){e("#editor_spoiler_title").val("")},
_init:function(a){e("#editor_spoiler_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();a=this.ed;var b=this.overlay;a.selection.restore();XF.EditorHelpers.insertSpoiler(a,e("#editor_spoiler_title").val());b.hide()}});XF.EditorDialogCode=XF.extend(XF.EditorDialog,{_beforeShow:function(a){this.ed.$el.blur()},_init:function(a){e("#editor_code_form").submit(XF.proxy(this,"submit"))},submit:function(a){a.preventDefault();a=this.ed;var b=this.overlay,d=b.$container.find(".CodeMirror");
if(d.length){d=d[0].CodeMirror;var c=d.getDoc();d.save();c.setValue("");d.setOption("mode","")}d=e("#editor_code_type");c=e("#editor_code_code");a.selection.restore();XF.EditorHelpers.insertCode(a,d.val(),c.val());b.hide();c.val("");d.val("")}});XF.editorStart={started:!1,custom:[],startAll:function(){XF.editorStart.started||(XF.editorStart.setupLanguage(),XF.editorStart.registerCommands(),XF.editorStart.registerCustomCommands(),XF.editorStart.registerEditorDropdowns(),XF.editorStart.registerDialogs(),
e(l).trigger("editor:first-start"),XF.editorStart.started=!0)},setupLanguage:function(){var a=e("html").attr("dir");try{var b=e.parseJSON(e(".js-editorLanguage").first().html())||{}}catch(d){console.error(d),b={}}e.FE.LANGUAGE.xf={translation:b,direction:a?a.toLowerCase():"ltr"}},registerCommands:function(){e.FE.DefineIcon("xfQuote",{NAME:"quote-right"});e.FE.RegisterCommand("xfQuote",{title:"Quote",icon:"xfQuote",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[QUOTE]",
"[/QUOTE]",!0)}});e.FE.DefineIcon("xfCode",{NAME:"code"});e.FE.RegisterCommand("xfCode",{title:"Code",icon:"xfCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"code")}});e.FE.DefineIcon("xfInlineCode",{NAME:"terminal"});e.FE.RegisterCommand("xfInlineCode",{title:"Inline Code",icon:"xfInlineCode",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,"[ICODE]","[/ICODE]",!0)}});e.FE.DefineIcon("xfMedia",{NAME:"video"});e.FE.RegisterCommand("xfMedia",
{title:"Media",icon:"xfMedia",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"media")}});e.FE.DefineIcon("xfSpoiler",{NAME:"flag"});e.FE.RegisterCommand("xfSpoiler",{title:"Spoiler",icon:"xfSpoiler",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.loadDialog(this,"spoiler")}});e.FE.DefineIcon("xfInlineSpoiler",{NAME:"flag-checkered"});e.FE.RegisterCommand("xfInlineSpoiler",{title:"Inline Spoiler",icon:"xfInlineSpoiler",undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,
"[ISPOILER]","[/ISPOILER]",!0)}});e.FroalaEditor.PLUGINS.xfSmilie=function(a){function b(b){var c=e(b.currentTarget);b=c.html();if(!e(b).hasClass("smilie--lazyLoad")){XF.EditorHelpers.focus(a);a.html.insert(b);n();XF.EditorHelpers.blur(a);if(p){var d=p.find(".js-emojiInsertedRow");d.find(".js-emojiInsert").html(b);d.addClassTransitioned("is-active");clearTimeout(v);v=setTimeout(function(){d.removeClassTransitioned("is-active")},1500)}clearTimeout(w);w=setTimeout(function(){XF.logRecentEmojiUsage(c.data("shortname"))},
1500)}}function d(a,b){for(var c,d,f=0;f<a.length;f++)c=a[f],c.isIntersecting&&(d=e(c.target),g(d),b.unobserve(c.target))}function c(a){var b=a;a instanceof Event&&(b=e(a.currentTarget));if(b.is(":visible")){var c=b[0].getBoundingClientRect(),d=c.bottom+100;b.children().each(function(){var a=e(this),b=this.getBoundingClientRect();if(!(b.bottom<c.top)){if(b.top>d)return!1;a.find("span.smilie--lazyLoad").each(function(){var a=e(this);this.getBoundingClientRect().top<=d&&g(a)})}})}}function g(a){var b=
e("<img />").attr({"class":a.attr("class").replace(/(\s|^)smilie--lazyLoad(\s|$)/," "),alt:a.attr("data-alt"),title:a.attr("title"),src:a.attr("data-src"),"data-shortname":a.attr("data-shortname")}),c=function(){var c=function(){a.replaceWith(b)};k.requestAnimationFrame?k.requestAnimationFrame(c):c()};if(b.prop("complete"))c();else b.on("load",c)}function h(){var a=e(this),d=p.find(".js-emojiFullList"),f=p.find(".js-emojiSearchResults");clearTimeout(x);x=setTimeout(function(){var e=a.val();if(!e||
2>e.length)f.hide(),d.show(),c(d);else{var h=XF.canonicalizeUrl("index.php?editor/smilies-emoji/search");XF.ajax("GET",h,{q:e},function(a){a.html&&XF.setupHtmlInsert(a.html,function(a){a.find(".js-emoji").on("click",b);d.hide();f.replaceWith(a)})})}},300)}function f(){var a=XF.getRecentEmojiUsage(),d=q.find(".js-recentHeader"),f=q.find(".js-recentBlock"),h=f.find(".js-recentList"),g=q.find(".js-emojiList");if(a){var n=h.clone(),k=[];n.empty();for(var l in a){var p=a[l],m;g.each(function(){m=e(this).find('.js-emoji[data-shortname="'+
p+'"]').closest("li").clone();if(m.length)return m.find(".js-emoji").on("click",b),k.push(m),!1})}for(l in k)k[l].appendTo(n);h.replaceWith(n);f.hasClass("is-hidden")&&(f.hide(),f.removeClass("is-hidden"),d.removeClass("is-hidden"),f.xfFadeDown(XF.config.speed.fast));c(n)}}function n(){a.selection.save()}function r(){a.selection.restore()}var m=!1,t=!1,p,q,u=0,v,w,x;return{showMenu:function(){n();XF.EditorHelpers.blur(a);var g=a.$tb.find('.fr-command[data-cmd="xfSmilie"]');if(!m){m=!0;p=e(e.parseHTML(Mustache.render(e(".js-xfSmilieMenu").first().html())));
p.insertAfter(g);g.data("xf-click","menu");var y=XF.Event.getElementHandler(g,"menu","click");p.on("menu:complete",function(){q=p.find(".menu-scroller");if(!t){t=!0;if(k.IntersectionObserver){var g=new IntersectionObserver(d,{root:q[0],rootMargin:"0px 0px 100px 0px"});q.find("span.smilie--lazyLoad").each(function(){g.observe(this)})}else q.onPassive("scroll",c);q.find(".js-emoji").on("click",b);var m=p.find(".js-emojiSearch");m.on("focus",n);m.on("blur",r);m.on("input",h);p.find(".js-emojiCloser").on("click",
function(){XF.EditorHelpers.focus(a)});e(l).on("recent-emoji:logged",f);a.events.on("commands.mousedown",function(a){"xfSmilie"!=a.data("cmd")&&y.close()});p.on("menu:closed",function(){u=q.scrollTop()})}q.scrollTop(u);k.IntersectionObserver||c(q)});p.on("menu:closed",function(){setTimeout(function(){a.markers.remove()},50)})}(g=g.data("xfClickHandlers"))&&g.menu&&g.menu.toggle()}}};e.FE.DefineIcon("xfSmilie",{NAME:"smile"});e.FE.RegisterCommand("xfSmilie",{title:"Smilies",icon:"xfSmilie",undo:!1,
focus:!1,refreshOnCallback:!1,callback:function(){this.xfSmilie.showMenu()}});e.FE.DefineIcon("xfDraft",{NAME:"save"});e.FE.RegisterCommand("xfDraft",{type:"dropdown",title:"Drafts",focus:!0,undo:!1,options:{xfDraftSave:"Save Draft",xfDraftDelete:"Delete Draft"},callback:function(a,b){a=this.$el.closest("form");a.length?(a=XF.Element.getHandler(a,"draft"))?"xfDraftSave"==b?a.triggerSave():"xfDraftDelete"==b&&a.triggerDelete():console.error("No draft handler on parent form"):console.error("No parent form to find draft handler")}});
e.extend(e.FE.DEFAULTS,{xfBbCodeAttachmentContextInput:"attachment_hash_combined"});e.FE.PLUGINS.bbCode=function(a){function b(){return a.$tb.find(".fr-command[data-cmd=xfBbCode]")}function d(){var b=a.$oel,c=b.data("xfBbCodeBox");if(!c){var d=parseInt(a.$wp.css("border-bottom-width"),10)+parseInt(a.$wp.css("border-top-width"),10);c=e('<textarea class="input" style="display: none" />');c.attr("aria-label",XF.htmlspecialchars(XF.phrase("rich_text_box")));c.css({minHeight:a.opts.heightMin?a.opts.heightMin+
d+"px":null,maxHeight:a.opts.heightMax?a.opts.heightMax+"px":null,height:a.opts.height?a.opts.height+d+"px":null,padding:a.$el.css("padding")});c.attr("name",b.data("original-name"));b.data("xfBbCodeBox",c);a.$wp.after(c);XF.Element.applyHandler(c,"textarea-handler");XF.Element.applyHandler(c,"user-mentioner");XF.Element.applyHandler(c,"emoji-completer")}return c}function c(c,e){var f=d(),g=function(c,d){h=!0;a.undo.saveStep();a.$el.blur();var e=b();a.$tb.find(" > .fr-command").not(e).addClass("fr-disabled");
e.addClass("fr-active");a.$wp.css("display","none");a.$oel.prop("disabled",!0);f.val(c).css("display","").prop("disabled",!1).trigger("autosize");d||f.autofocus();XF.setIsEditorEnabled(!1)};"string"==typeof c?g(c,e):XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-bb-code"),{html:a.html.get()},function(a){g(a.bbCode,e)})}function g(c){var f=d(),g=function(c){h=!1;var d=b();a.$tb.find(" > .fr-command").not(d).removeClass("fr-disabled");d.removeClass("fr-active");a.$oel.prop("disabled",!1);a.html.set(c);
f.css("display","none").prop("disabled",!0);a.$wp.css("display","");a.events.focus();a.undo.saveStep();a.size.refresh();XF.setIsEditorEnabled(!0);XF.layoutChange()};if("string"==typeof c)g(c);else{c={bb_code:f.val()};var k=a.$el.closest("form");k.length&&k[0][a.opts.xfBbCodeAttachmentContextInput]&&(c.attachment_hash_combined=e(k[0][a.opts.xfBbCodeAttachmentContextInput]).val());XF.ajax("POST",XF.canonicalizeUrl("index.php?editor/to-html"),c,function(a){g(a.editorHtml)})}}var h=!1;return{_init:function(){a.events.on("buttons.refresh",
function(){return!h})},toBbCode:c,isBbCodeView:function(){return h},getTextArea:function(){return h?d():null},insertBbCode:function(a){if(h){var b=d();XF.insertIntoTextBox(b,a)}},replaceBbCode:function(a){if(h){var b=d();XF.replaceIntoTextBox(b,a)}},toHtml:g,toggle:function(){h?g():c()}}};e.FE.DefineIcon("xfBbCode",{NAME:"cog"});e.FE.RegisterCommand("xfBbCode",{title:"Toggle BB Code",icon:"xfBbCode",undo:!1,focus:!1,forcedRefresh:!0,callback:function(){this.bbCode.toggle()}})},registerCustomCommands:function(){try{var a=
e.parseJSON(e(".js-editorCustom").first().html())||{}}catch(d){console.error(d),a={}}for(var b in a)a.hasOwnProperty(b)&&function(a,b){var c="xfCustom_"+a,d=a.toUpperCase();a={};"fa"==b.type?a=(a=b.value.match(/^fa([slrb]) fa-(.+)$/))?{FA5NAME:a[2],template:"font_awesome_5"+("s"===a[1]?"":a[1])}:{NAME:b.value}:"image"==b.type&&(a={template:"image",SRC:'"'+XF.canonicalizeUrl(b.value)+'"',ALT:'"'+b.title+'"'});e.FE.DefineIcon(c,a);e.FE.RegisterCommand(c,{title:b.title,icon:c,undo:!0,focus:!0,callback:function(){XF.EditorHelpers.wrapSelectionText(this,
"yes"==b.option?"["+d+"=]":"["+d+"]","[/"+d+"]",!0)}});XF.editorStart.custom.push(c)}(b,a[b])},registerEditorDropdowns:function(){try{var a=e.parseJSON(e(".js-editorDropdowns").first().html())||{}}catch(d){console.error("Editor dropdowns data not valid: ",d),a={}}for(var b in a)a.hasOwnProperty(b)&&function(a,b){b.icon=b.icon.substr(3);e.FE.DefineIcon(a,{NAME:b.icon});e.FE.RegisterCommand(a,{type:"dropdown",title:b.title,icon:a,undo:!1,focus:!1,html:function(){var c='<ul class="fr-dropdown-list">',
d=b.buttons,f,k;(f=XF.getEditorInContainer(this.$oel))&&f.buttonManager&&(d=f.buttonManager.getDropdown(a));for(var l in d)f=d[l],(k=e.FE.COMMANDS[f])&&(c+='<li><a class="fr-command" data-cmd="'+f+'">'+this.icon.create(k.icon||f)+"&nbsp;&nbsp;"+this.language.translate(k.title)+"</a></li>");return c+"</ul>"}})}(b,a[b])},registerDialogs:function(){XF.EditorHelpers.dialogs.media=new XF.EditorDialogMedia("media");XF.EditorHelpers.dialogs.spoiler=new XF.EditorDialogSpoiler("spoiler");XF.EditorHelpers.dialogs.code=
new XF.EditorDialogCode("code")}};e(l).one("editor:start",XF.editorStart.startAll);XF.EditorPlaceholderClick=XF.Event.newHandler({eventNameSpace:"XFEditorPlaceholderClick",options:{},edInitialized:!1,init:function(){},click:function(a){var b=this.$target,d=this;a=function(){d.edInitialized=!0;b.find(".editorPlaceholder-editor").removeClass("is-hidden");b.find(".editorPlaceholder-placeholder").addClass("is-hidden")};var c=XF.getEditorInContainer(b);c instanceof XF.Editor?this.edInitialized||c.startInit({beforeInit:a,
afterInit:function(a,b){XF.EditorHelpers.focus(b);XF.isIOS()&&(a.scrollToCursor(),a.scrollToCursorAfterPendingResize());b.opts.tooltips&&setTimeout(function(){b.tooltip.hide()},30)}}):(a(),c instanceof e&&c.focus())}});XF.Event.register("click","editor-placeholder","XF.EditorPlaceholderClick");XF.Element.register("editor","XF.Editor")}(jQuery,window,document);
