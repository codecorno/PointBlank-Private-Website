var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(d,g,e){d instanceof String&&(d=String(d));for(var l=d.length,a=0;a<l;a++){var b=d[a];if(g.call(e,b,a,d))return{i:a,v:b}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(d,g,e){d!=Array.prototype&&d!=Object.prototype&&(d[g]=e.value)};
$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.polyfill=function(d,g,e,l){if(g){e=$jscomp.global;d=d.split(".");for(l=0;l<d.length-1;l++){var a=d[l];a in e||(e[a]={});e=e[a]}d=d[d.length-1];l=e[d];g=g(l);g!=l&&null!=g&&$jscomp.defineProperty(e,d,{configurable:!0,writable:!0,value:g})}};
$jscomp.polyfill("Array.prototype.find",function(d){return d?d:function(d,e){return $jscomp.findInternal(this,d,e).v}},"es6","es3");
!function(d,g,e,l){XF.Message=XF.Message||{};XF.Message.insertMessages=function(a,b,c,k){XF.setupHtmlInsert(a,function(a,f,e){f=b.find(".js-replyNoMessages");f.length&&f.xfFadeUp();a.each(function(){this.tagName&&XF.Message.insertMessage(d(this),b,c)});k&&k(a)})};XF.Message.insertMessage=function(a,b,c){var d=b.children().first();a.hide();d.is("form")&&!c?a.insertAfter(d):c?b.append(a):b.prepend(a);a.xfFadeDown();XF.activate(a)};XF.MessageLoaderClick=XF.Event.newHandler({eventNameSpace:"XFMessageLoaderClick",
options:{href:null,messagesContainer:"< .js-replyNewMessageContainer",selfContainer:".message",ascending:!0},loading:!1,init:function(){this.options.href||(this.options.href=this.$target.attr("href"),this.options.href||console.error("Must be initialized with a data-href or href attribute."))},click:function(a){a.preventDefault();if(!this.loading){var b=this;XF.ajax("GET",this.options.href,{},XF.proxy(this,"loaded")).always(function(){b.loading=!1})}},loaded:function(a){if(a.html){var b=XF.findRelativeIf(this.options.messagesContainer,
this.$target);XF.Message.insertMessages(a.html,b,this.options.ascending);var c=this.$target.closest(this.options.selfContainer);c.xfFadeUp(null,function(){c.remove()});a.lastDate&&d('.js-quickReply input[name="last_date"]').val(a.lastDate)}}});XF.QuickEditClick=XF.Event.newHandler({eventNameSpace:"XFQuickEdit",options:{editorTarget:null,editContainer:".js-editContainer",href:null,noInlineMod:0},$editorTarget:null,$editForm:null,href:null,loading:!1,init:function(){var a=this.options.editorTarget;
a?(this.$editorTarget=XF.findRelativeIf(a,this.$target),this.$editorTarget.length?(this.href=this.options.href||this.$target.attr("href"))||console.error("No edit URL specified."):console.error("No quick edit target found")):console.error("No quick edit editorTarget specified")},click:function(a){this.$editorTarget&&this.href&&(a.preventDefault(),this.loading||(this.loading=!0,a={},this.options.noInlineMod&&(a._xfNoInlineMod=!0),XF.ajax("GET",this.href,a,XF.proxy(this,"handleAjax"),{skipDefaultSuccessError:!0})))},
handleAjax:function(a){var b=this.$editorTarget,c=this;a.errors?(this.loading=!1,XF.alert(a.errors)):XF.setupHtmlInsert(a.html,function(a,d){a.hide().insertAfter(b);XF.activate(a);c.$editForm=a;a.on("ajax-submit:response",XF.proxy(c,"editSubmit"));a.find(".js-cancelButton").on("click",XF.proxy(c,"cancelClick"));a.find("input[type=hidden]").first().after('<input type="hidden" name="_xfInlineEdit" value="1" />');b.xfFadeUp(null,function(){b.parent().addClass("is-editing");a.xfFadeDown(XF.config.speed.normal,
function(){a.trigger("quick-edit:shown");var b=a.find(c.options.editContainer);b.length&&!XF.isElementVisible(b)&&b.get(0).scrollIntoView(!0);c.loading=!1})});a.trigger("quick-edit:show")})},editSubmit:function(a,b){if(!b.errors&&!b.exception){a.preventDefault();b.message&&XF.flashMessage(b.message,3E3);var c=this.$editorTarget,d=this;XF.setupHtmlInsert(b.html,function(a,k,e){k=d.options.editorTarget;k=k.replace(/<|\|/g,"").replace(/#[a-zA-Z0-9_-]+\s*/,"");var h=a.find(k);h.hide();c.replaceWith(h);
d.$editorTarget=h;XF.activate(h);d.stopEditing(!1,function(){h.xfFadeDown();d.$editForm.trigger("quickedit:editcomplete",b)})})}},cancelClick:function(a){this.stopEditing(!0)},stopEditing:function(a,b){var c=this.$editorTarget,d=this.$editForm,h=this,f=function(){c.parent().removeClass("is-editing");a&&c.xfFadeDown();b&&b();d.remove();h.$editForm=null};d?d.xfFadeUp(null,f):f()}});XF.QuoteClick=XF.Event.newHandler({eventNameSpace:"XFQuoteClick",options:{quoteHref:null,editor:".js-quickReply .js-editor"},
init:function(){this.options.quoteHref||console.error("Must be initialized with a data-quote-href attribute.")},click:function(a){a.preventDefault();var b=this.options.quoteHref,c=d(a.target).parents(".tooltip--selectToQuote");c=XF.unparseBbCode(c.data("quote-html"));XF.ajax("POST",b,{quoteHtml:c},XF.proxy(this,"handleAjax"),{skipDefaultSuccess:!0});d(a.target).trigger("s2q:click");a=XF.findRelativeIf(this.options.editor,this.$target);a.closest(".js-quickReply").get(0).scrollIntoView(!0);XF.focusEditor(a)},
handleAjax:function(a){var b=XF.findRelativeIf(this.options.editor,this.$target);XF.insertIntoEditor(b,a.quoteHtml,a.quote)}});XF.MultiQuote=XF.Element.newHandler({options:{href:"",messageSelector:"",addMessage:"",removeMessage:"",storageKey:""},mqStorage:null,mqOverlay:null,removing:!1,quoting:!1,init:function(){this.initButton();this.initControls();var a=this;XF.CrossTab.on("mqChange",function(b){if(b.storageKey===a.options.storageKey){var c=b.messageId;switch(b.action){case "added":a.selectMqControl(c);
break;case "removed":a.deselectMqControl(c)}a.refreshMqData();a.updateButtonState()}})},initButton:function(){this.mqStorage=XF.LocalStorage.getJson(this.options.storageKey);this.hasQuotesStored()&&this.$target.show();this.$target.on("click",XF.proxy(this,"buttonClick"))},buttonClick:function(a){a.preventDefault();if(!this.options.href)return console.error("Multi-quote button must have a data-href attribute set to display selected quotes"),!1;XF.ajax("post",this.options.href,{quotes:XF.LocalStorage.get(this.options.storageKey)},
XF.proxy(this,"loadOverlay"))},loadOverlay:function(a){if(a.html){var b=this;XF.setupHtmlInsert(a.html,function(a,d){a=XF.getOverlayHtml({html:a,title:d.h1||d.title});a.find(".js-removeMessage").on("click",XF.proxy(b,"removeMessage"));a.find(".js-quoteMessages").on("click",XF.proxy(b,"quoteMessages"));b.mqOverlay=XF.showOverlay(a)})}},removeMessage:function(a){a.preventDefault();if(!this.removing){this.removing=!0;var b=d(a.target).closest(".nestable-item");a=b.data("id");var c=this.mqOverlay;this.removeFromMultiQuote(a);
b.xfFadeUp(XF.config.speed.fast,function(){b.remove()});this.hasQuotesStored()||c.hide();this.removing=!1}},quoteMessages:function(a){a.preventDefault();if(!this.quoting){this.quoting=!0;a=this.mqOverlay;var b=a.getOverlay();b=d.parseJSON(b.find('input[name="message_ids"]').val());var c=this.mqStorage,k=this,h;for(h in b)if(b.hasOwnProperty(h)&&b[h].hasOwnProperty("id")){var f=b[h].id.split("-"),e=f[0];f=f[1];this.isValidQuote(c[e],f)&&(e=c[e][f],!0!==e&&(e=XF.unparseBbCode(e)),b[h].value=e)}a.hide();
XF.ajax("post",this.options.href,{insert:b,quotes:XF.LocalStorage.get(this.options.storageKey)},XF.proxy(this,"insertMessages")).always(function(){k.quoting=!1})}},isValidQuote:function(a,b){return void 0==a||!a.hasOwnProperty(b)||!0!==a[b]&&"string"!=typeof a[b]?!1:!0},insertMessages:function(a){var b=XF.findRelativeIf("form .js-editor",this.$target);b.length||(b=d(".js-editor").parent());d.each(a,function(a,c){if(!c.hasOwnProperty("quote")||!c.hasOwnProperty("quoteHtml"))return!0;XF.insertIntoEditor(b,
c.quoteHtml,c.quote)});for(var c in this.mqStorage)this.removeFromMultiQuote(c)},initControls:function(){var a=".tooltip--selectToQuote, "+this.options.messageSelector,b=d(a).find(".js-multiQuote");d(e).on("click",a,XF.proxy(this,"controlClick"));var c=this;b.each(function(){var a=d(this),b=a.data("messageId");c.mqStorage.hasOwnProperty(b)&&(a.addClass("is-selected"),a.data("mqAction","remove"))})},controlClick:function(a){if(d(a.target).is(".js-multiQuote")){a.preventDefault();var b=d(a.target),
c=b.data("mqAction");b=b.data("messageId");switch(c){case "add":this.addToMultiQuote(b);XF.flashMessage(this.options.addMessage,3E3);break;case "remove":this.removeFromMultiQuote(b),XF.flashMessage(this.options.removeMessage,3E3)}d(a.target).trigger("s2q:click")}},addToMultiQuote:function(a){var b=d('.js-multiQuote[data-message-id="'+a+'"]').parents(".tooltip--selectToQuote"),c=XF.unparseBbCode(b.data("quote-html"));this.refreshMqData();this.hasQuotesStored()?this.mqStorage[a]||(this.mqStorage[a]=
[]):(this.mqStorage={},this.mqStorage[a]=[]);b.length?this.mqStorage[a].push(c):this.mqStorage[a].push(!0);this.updateMultiQuote();this.selectMqControl(a);this.triggerCrossTabEvent("added",a)},removeFromMultiQuote:function(a){var b=String(a).match(/^(\d+)-(\d+)$/);this.refreshMqData();b?(a=b[1],delete this.mqStorage[a][b[2]],this.getQuoteStoreCount(this.mqStorage[a])||delete this.mqStorage[a]):delete this.mqStorage[a];this.updateMultiQuote();this.mqStorage[a]||(this.deselectMqControl(a),this.triggerCrossTabEvent("removed",
a))},selectMqControl:function(a){a=d('.js-multiQuote[data-message-id="'+a+'"]');a.length&&(a.addClass("is-selected"),a.data("mqAction","remove"))},deselectMqControl:function(a){a=d('.js-multiQuote[data-message-id="'+a+'"]');a.length&&(a.removeClass("is-selected"),a.data("mqAction","add"))},getQuoteStoreCount:function(a){var b=0,c;for(c in a)a.hasOwnProperty(c)&&(1==a[c]||"string"==typeof a[c])&&b++;return b},updateMultiQuote:function(){XF.LocalStorage.setJson(this.options.storageKey,this.mqStorage,
!0);this.updateButtonState()},updateButtonState:function(){this.hasQuotesStored()?this.$target.show():this.$target.hide()},refreshMqData:function(){this.mqStorage=XF.LocalStorage.getJson(this.options.storageKey)},hasQuotesStored:function(){return this.mqStorage&&!d.isEmptyObject(this.mqStorage)},triggerCrossTabEvent:function(a,b,c){c=c||{};c.storageKey=this.options.storageKey;c.action=a;c.messageId=b;XF.CrossTab.trigger("mqChange",c)}});XF.SelectToQuote=XF.Element.newHandler({options:{messageSelector:""},
$quickReply:null,timeout:null,processing:!1,isMouseDown:!1,tooltip:null,tooltipId:null,init:function(){g.getSelection&&(this.options.messageSelector?(this.$quickReply=d(".js-quickReply .js-editor").parent(),this.$quickReply.length&&(this.$target.on("mousedown",XF.proxy(this,"mouseDown")),this.$target.on("mouseup",XF.proxy(this,"mouseUp")),d(e).on("selectionchange",XF.proxy(this,"selectionChange")))):console.error("No messageSelector"))},mouseDown:function(){this.isMouseDown=!0},mouseUp:function(){this.isMouseDown=
!1;this.trigger()},selectionChange:function(){this.isMouseDown||this.trigger()},trigger:function(){this.timeout||this.processing||(this.timeout=setTimeout(XF.proxy(this,"handleSelection"),100))},handleSelection:function(){this.processing=!0;this.timeout=null;var a=g.getSelection(),b=this.getValidSelectionContainer(a);b?this.showQuoteButton(b,a):this.hideQuoteButton();var c=this;setTimeout(function(){c.processing=!1},0)},getValidSelectionContainer:function(a){if(a.isCollapsed||!a.rangeCount)return null;
a=a.getRangeAt(0);this.adjustRange(a);if(!d.trim(a.toString()).length&&!a.cloneContents().querySelectorAll("img").length)return null;var b=d(a.commonAncestorContainer).closest(".js-selectToQuote");return!b.length||!b.closest(this.options.messageSelector).find('.actionBar-action[data-xf-click="quote"]').length||d(a.startContainer).closest(".bbCodeBlock--quote, .js-noSelectToQuote").length||d(a.endContainer).closest(".bbCodeBlock--quote, .js-noSelectToQuote").length?null:b},adjustRange:function(a){var b=
!1,c=!1,k=a.endContainer,e=d(k);0==a.endOffset&&(3!=k.nodeType||k.previousSibling||(e=e.parent()),c=0<e.closest(".bbCodeBlock--quote").length);c&&(c=e.closest(".bbCodeBlock--quote"),c.length&&(a.setEndBefore(c[0]),b=!0));b&&(b=g.getSelection(),b.removeAllRanges(),b.addRange(a))},showQuoteButton:function(a,b){var c=a.xfUniqueId();this.tooltip&&this.tooltipId===c||(this.hideQuoteButton(),this.createButton(a,c));a=this.tooltip.getTooltip();a.data("quote-html",this.getSelectionHtml(b));b=this.getButtonPositionMarker(b);
XF.browser.android&&(b.top+=10);this.tooltip.setPositioner([b.left,b.top]);this.tooltip.isShown()?this.tooltip.reposition():this.tooltip.show();a.addClass("tooltip--selectToQuote")},getButtonPositionMarker:function(a){var b=d("<span />").text("\u200b");var c=a.getRangeAt(0).cloneRange();a=c.getBoundingClientRect?c.getBoundingClientRect():null;c.collapse(!1);c.insertNode(b[0]);var e=0;do{c=!1;e++;b[0].parentNode&&"js-selectToQuoteEnd"==b[0].parentNode.className&&(b.insertBefore(b[0].parentNode),c=
!0);b[0].previousSibling&&3==b[0].previousSibling.nodeType&&0==d.trim(b[0].previousSibling.textContent).length&&(b.insertBefore(b[0].previousSibling),c=!0);if(b[0].parentNode&&"LI"==b[0].parentNode.tagName&&!b[0].previousSibling){var h=b[0].parentNode;d(h).prev("li").length?(b.appendTo(d(h).prev("li")),c=!0):h.parentNode&&(b.insertBefore(h.parentNode),c=!0)}b[0].parentNode&&!b[0].previousSibling&&-1!=d.inArray(b[0].parentNode.tagName,["DIV","BLOCKQUOTE","PRE"])&&(b.insertBefore(b[0].parentNode),c=
!0);b[0].previousSibling&&-1!=d.inArray(b[0].previousSibling.tagName,["OL","UL"])&&(d(b[0].previousSibling).find("li:last").append(b),c=!0);b[0].previousSibling&&-1!=d.inArray(b[0].previousSibling.tagName,["DIV","BLOCKQUOTE","PRE"])&&(b.appendTo(b[0].previousSibling),c=!0);b[0].previousSibling&&"BR"==b[0].previousSibling.tagName&&(b.insertBefore(b[0].previousSibling),c=!0)}while(c&&5>e);var f=b.offset();c=b.height();b.parentsUntil("body").each(function(){var a=d(this);switch(a.css("overflow-x")){case "hidden":case "scroll":case "auto":var b=
a.offset().left;a=b+a.outerWidth();f.left<b&&(f.left=b);a<f.left&&(f.left=a)}});e=b.parent();b.remove();XF.browser.msie||e[0].normalize();a&&!XF.isRtl()&&32<f.left-a.left&&(f.left-=16);f.top+=c;return f},createButton:function(a,b){var c=a.closest(this.options.messageSelector);a=d("<span />");var k=c.find(".actionBar-action.js-multiQuote").clone();k.length&&(k.attr("title","").removeClass("is-selected").data("mqAction","add").css({marginLeft:0,background:"transparent"}).on("s2q:click",XF.proxy(this,
"buttonClicked")),a.append(k),a.append(e.createTextNode(" | ")));c=c.find('.actionBar-action[data-xf-click="quote"]').attr("title","").clone().css({marginLeft:0}).on("s2q:click",XF.proxy(this,"buttonClicked"));a.append(c);this.tooltip=new XF.TooltipElement(a,{html:!0,placement:"bottom"});this.tooltipId=b},buttonClicked:function(){var a=g.getSelection();a.isCollapsed||(a.collapse(a.getRangeAt(0).commonAncestorContainer,0),this.hideQuoteButton())},hideQuoteButton:function(){var a=this.tooltip;a&&(a.destroy(),
this.tooltip=null)},getSelectionHtml:function(a){var b=e.createElement("div"),c;var d=0;for(c=a.rangeCount;d<c;d++)b.appendChild(a.getRangeAt(d).cloneContents());return this.prepareSelectionHtml(b.innerHTML)},prepareSelectionHtml:function(a){return XF.adjustHtmlForRte(a)}});XF.QuickReply=XF.Element.newHandler({options:{messageContainer:"",ascending:!0,filesContainer:".js-attachmentFiles",fileRow:".js-attachmentFile",insertAllRow:".js-attachmentInsertAllRow",submitHide:null},init:function(){this.$target.on("ajax-submit:before",
XF.proxy(this,"beforeSubmit"));this.$target.on("ajax-submit:response",XF.proxy(this,"afterSubmit"));this.$target.on("draft:complete",XF.proxy(this,"onDraft"))},beforeSubmit:function(a,b){(b=b.submitButton)&&"more_options"==b.attr("name")&&a.preventDefault()},afterSubmit:function(a,b){if(!b.errors&&!b.exception)if(a.preventDefault(),b.redirect)XF.redirect(b.redirect);else{this.$target.find('input[name="last_date"]').val(b.lastDate);this.getMessagesContainer().find(".js-newMessagesIndicator").remove();
this.insertMessages(b.html);XF.clearEditorContent(this.$target);(a=XF.getEditorInContainer(this.$target))&&XF.Editor&&a instanceof XF.Editor&&a.blur();b=this.options;var c=this.$target.find(b.filesContainer);c.length&&(c.removeClass("is-active"),a=c.find(b.insertAllRow),b=c.find(b.fileRow),a.length&&a.removeClass("is-active"),b.length&&b.remove());this.$target.trigger("preview:hide",[this]);this.options.submitHide&&XF.findRelativeIf(this.options.submitHide,this.$target).hide()}},insertMessages:function(a){XF.Message.insertMessages(a,
this.getMessagesContainer(),this.options.ascending,function(a){if((a=a.first())&&a.length){a=a.dimensions();var b=d(g).scrollTop(),e=b+d(g).height();(a.top<b+50||a.top>e)&&d("html, body").animate({scrollTop:Math.max(0,a.top-60)},200)}})},getMessagesContainer:function(){var a=this.options.messageContainer;return a?XF.findRelativeIf(a,this.$target).first():d(".js-replyNewMessageContainer").first()},onDraft:function(a,b){b.hasNew&&b.html&&!this.getMessagesContainer().find(".js-newMessagesIndicator").length&&
this.insertMessages(b.html)}});XF.GuestCaptcha=XF.Element.newHandler({options:{url:"index.php?misc/captcha&with_row=1",target:".js-captchaContainer",skip:"[name=more_options]"},$captchaContainer:null,initialized:!1,init:function(){var a=this.$target;this.$captchaContainer=a.find(this.options.target);this.$captchaContainer.length&&(a.on("focusin",XF.proxy(this,"initializeCaptcha")),a.on("submit ajax-submit:before",XF.proxy(this,"submit")))},initializeCaptcha:function(a){a=d(e.activeElement);this.initialized||
a.is(this.options.skip)||(a=this.$captchaContainer.data("row-type")||"",XF.ajax("get",XF.canonicalizeUrl(this.options.url),{row_type:a},XF.proxy(this,"showCaptcha")),this.initialized=!0)},showCaptcha:function(a){var b=this;XF.setupHtmlInsert(a.html,function(a,d,e){a.replaceAll(b.$captchaContainer);e()})},submit:function(a){if(!this.initialized&&!d(e.activeElement).is(this.options.skip))return a.preventDefault(),!1}});XF.PostEdit=XF.Element.newHandler({init:function(){this.$target.on("quickedit:editcomplete",
XF.proxy(this,"editComplete"))},editComplete:function(a,b){var c=this;XF.setupHtmlInsert(b.html,function(a,e,f){f=b.threadChanges||{};f.title&&(d("h1.p-title-value").html(e.h1),d("title").html(e.title),XF.config.visitorCounts.title_count&&b.visitor&&(XF.pageTitleCache=e.title,XF.pageTitleCounterUpdate(b.visitor.total_unread)));if(f.customFields){var h=a.closest(".js-threadStatusField"),g=XF.findRelativeIf("< .block--messages | .js-threadStatusField",c.$target);h.length&&g.length&&g.xfFadeUp(XF.config.speed.fast,
function(){g.replaceWith(h).xfFadeDown(XF.config.speed.fast)})}else a.find(".js-threadStatusField").remove()})}});XF.Event.register("click","message-loader","XF.MessageLoaderClick");XF.Event.register("click","quick-edit","XF.QuickEditClick");XF.Event.register("click","quote","XF.QuoteClick");XF.Element.register("multi-quote","XF.MultiQuote");XF.Element.register("select-to-quote","XF.SelectToQuote");XF.Element.register("quick-reply","XF.QuickReply");XF.Element.register("guest-captcha","XF.GuestCaptcha");
XF.Element.register("post-edit","XF.PostEdit")}(jQuery,window,document);
